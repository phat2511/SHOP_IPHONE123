@model List<SHOP_IPHONE.Models.CartItemModel>
@{
    ViewBag.Title = "Giỏ hàng";
}

@functions {
    public string GetColorHex(string variant)
    {
        switch (variant?.ToLower())
        {
            case string v when v.Contains("đen"): return "#000";
            case string v when v.Contains("trắng"): return "#fff";
            case string v when v.Contains("xanh"): return "#007bff";
            case string v when v.Contains("vàng"): return "#f1c40f";
            case string v when v.Contains("tím"): return "#8e44ad";
            case string v when v.Contains("hồng"): return "#ff69b4";
            case string v when v.Contains("bạc"): return "#bdc3c7";
            default: return "#ccc";
        }
    }
}

<h2>🛒 Giỏ hàng của bạn</h2>

@if (TempData["CartMessage"] != null)
{
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
        <i class="fa fa-exclamation-triangle"></i> @TempData["CartMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@if (TempData["Message"] != null)
{
    <div class="alert alert-info alert-dismissible fade show" role="alert">
        <i class="fa fa-info-circle"></i> @TempData["Message"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@if (Model == null || Model.Count == 0)
{
    <div class="alert alert-info">
        <i class="fa fa-shopping-cart"></i> Giỏ hàng trống. 
        <a href="@Url.Action("Index", "Product")" class="btn btn-primary btn-sm ms-2">Mua sắm ngay</a>
    </div>
}
else
{
    <table class="table table-bordered shadow-sm rounded bg-white align-middle" style="font-size: 16px;">
        <thead>
            <tr>
                <th>Ảnh</th>
                <th>Sản Phẩm</th>
                <th>Giá</th>
                <th>Số lượng</th>
                <th>Thành tiền</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td>
                        @if (item.Images != null && item.Images.Length > 0)
                        {
                            <img src="data:image/png;base64,@Convert.ToBase64String(item.Images)" alt="@item.ProductName"
                                 style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px; box-shadow: 0 0 5px rgba(0,0,0,0.1);" />
                        }
                        else
                        {
                            <span>Không có ảnh</span>
                        }
                    </td>
                    <td>
                        <div>
                            <strong>@item.ProductName</strong><br />
                            <span style="display: inline-flex; align-items: center;">
                                <span style="width: 14px; height: 14px; border-radius: 50%; background-color:@GetColorHex(item.Variant); border: 1px solid #ccc; margin-right: 5px;"></span>
                                <span style="text-transform: capitalize;">@item.Variant</span>
                            </span>
                        </div>
                    </td>
                    <td>@String.Format("{0:N0}", item.Price) ₫</td>
                    <td>
                        <span class="fw-bold">@item.Quantity</span>
                    </td>
                    <td>@String.Format("{0:N0}", item.Total) ₫</td>
                    <td>
                        @Html.ActionLink("🗑 Xóa", "Remove", new { id = item.ProductId, variant = item.Variant }, new { @class = "text-danger" })
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <div class="text-end mt-4">
        <h4 class="fw-bold">
            Tổng cộng:
            <span class="text-danger">@String.Format("{0:N0}", ViewBag.Total) VNĐ</span>
        </h4>
        <div class="mt-3">
            @Html.ActionLink("Xóa tất cả", "Clear", "Cart", null, new { @class = "btn btn-danger fw-bold me-2" })
            <a href="@Url.Action("Confirm", "Order")" class="btn btn-primary fw-bold me-2" onclick="return confirm('Bạn có chắc muốn thanh toán?')">Thanh toán</a>
            @Html.ActionLink("Tiếp tục mua", "Index", "Product", null, new { @class = "btn btn-secondary fw-bold" })
        </div>
    </div>
}
@Html.ActionLink("Quay lại", "Index", "Product", null, new { @class = "btn btn-secondary mt-4" })